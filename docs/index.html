<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <title>测试</title>
  <link rel="stylesheet" href="static/css/styles.css">
</head>

<body>
  <!-- 新增切换按钮 -->
  <button class="theme-toggle" id="themeToggle">暗黑模式</button>

  <!-- 在container div内添加控制栏 -->
  <div class="container">
    <div class="controls"><!--已经隐藏但仍起作用-->
      <label>每行显示数量：</label>
      <input type="number" id="columnCount" min="1" max="14" value="14">
    </div>
    <h1>项目展示</h1>
    <div class="search-container" style="width: 100%">
      <form action="" method="get" id="searchForm" style="width: 80%">
        <select name="engine" id="engineSelect" style="width: 100px">
          <option value="https://www.bing.com/search?q=">Bing</option>
          <option value="https://www.baidu.com/s?wd=">Baidu</option>
        </select>
        <input type="text" name="query" placeholder="请输入搜索内容" style="width: 60%" />
        <input type="submit" value="搜索" style="width: 100px" />
      </form>
    </div>
    <div id="content-container" class="grid-container"></div>
  </div>

  <script>
    //搜索功能
    document.getElementById("searchForm").onsubmit = function () {
      var engine = document.getElementById("engineSelect").value;
      var query = document.querySelector('input[name="query"]').value;
      window.location.href = engine + encodeURIComponent(query);
      return false;
    };

    //列表展示
    // 初始化元素引用
    const columnControl = document.getElementById('columnCount');
    const gridContainer = document.getElementById('content-container');

    // 唯一updateColumns函数
    function updateColumns() {
      const count = parseInt(columnControl.value);
      const containerWidth = gridContainer.offsetWidth;

      // 动态计算卡片宽度
      const gapTotal = 200 * (count - 1);
      const cardWidth = Math.max(20, (containerWidth - gapTotal) / count);

      // 同时设置CSS变量和具体宽度
      gridContainer.style.setProperty('--column-count', count);
      gridContainer.style.gridTemplateColumns = `repeat(${count}, minmax(${cardWidth}px, 1fr))`;
    }

    // 事件监听
    columnControl.addEventListener('input', updateColumns);
    columnControl.addEventListener('change', updateColumns);

    // 防抖的resize处理
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(updateColumns, 200);
    });

    // 修改后的数据加载逻辑
    fetch('data.json')
      .then(response => response.json())
      .then(data => {
        const container = document.getElementById('content-container');
        data.items.forEach(item => {
          container.innerHTML += `
        <div class="card">
          <img src="${item.image}" alt="${item.title}">
          <h3>${item.title}</h3>
          <p>${item.description}</p>
        </div>`;
        });
        // 初始化列数
        updateColumns();
      })
      .catch(error => console.error('数据加载失败:', error));


    // 新增暗黑模式切换功能
    const themeToggle = document.getElementById('themeToggle');

    // 从本地存储加载主题设置
    function loadTheme() {
      const isDark = localStorage.getItem('theme') === 'dark';
      document.body.classList.toggle('dark-mode', isDark);
      themeToggle.textContent = isDark ? '亮色模式' : '暗黑模式';
    }

    // 切换主题并保存设置
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      themeToggle.textContent = isDark ? '亮色模式' : '暗黑模式';
    }

    // 初始化主题设置
    loadTheme();
    themeToggle.addEventListener('click', toggleTheme);
  </script>
</body>

</html>